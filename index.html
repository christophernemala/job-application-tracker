<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O2C Reconciliation Platform - World #1</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>:root{--primary-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--success-color:#43e97b;--warning-color:#ff6b9d;--info-color:#4facfe;--gold-color:#ffd700;--text-primary:#fff;--glass-bg:rgba(255,255,255,0.1);--glass-border:rgba(255,255,255,0.2);--card-bg:rgba(255,255,255,0.1);--card-border:rgba(255,255,255,0.2);--card-hover:rgba(255,255,255,0.15);--transition-speed:0.3s;--border-radius:16px;--spacing-sm:1rem;--spacing-md:1.5rem;--spacing-lg:2rem;--spacing-xl:3rem}*{margin:0;padding:0;box-sizing:border-box}body{font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--primary-gradient);min-height:100vh;overflow-x:hidden;color:var(--text-primary);line-height:1.6}.background-animation{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;overflow:hidden;pointer-events:none}.gradient-orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.6;animation:float 20s infinite ease-in-out}.orb-1{width:500px;height:500px;background:radial-gradient(circle,var(--warning-color) 0%,transparent 70%);top:-10%;left:-10%}.orb-2{width:400px;height:400px;background:radial-gradient(circle,var(--info-color) 0%,transparent 70%);bottom:-10%;right:-10%;animation-delay:7s}.orb-3{width:600px;height:600px;background:radial-gradient(circle,var(--success-color) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:14s}@keyframes float{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(30px,-50px) scale(1.1)}66%{transform:translate(-20px,30px) scale(.9)}}.container{max-width:1400px;margin:0 auto;padding:0 var(--spacing-lg)}.header{background:var(--glass-bg);backdrop-filter:blur(20px);border-bottom:1px solid var(--glass-border);padding:var(--spacing-md) 0;position:sticky;top:0;z-index:100;box-shadow:0 8px 32px rgba(0,0,0,.1)}.header-content{display:flex;justify-content:space-between;align-items:center;gap:var(--spacing-lg);flex-wrap:wrap}.logo{display:flex;align-items:center;gap:var(--spacing-sm);color:var(--text-primary)}.logo h1{font-size:1.8rem;font-weight:800}.badge{display:flex;align-items:center;gap:.3rem;background:linear-gradient(135deg,var(--gold-color) 0%,#ffed4e 100%);color:#333;padding:.3rem .8rem;border-radius:20px;font-size:.75rem;font-weight:700;box-shadow:0 4px 15px rgba(255,215,0,.4)}.nav{display:flex;gap:var(--spacing-sm)}.nav-btn{background:var(--glass-bg);border:1px solid var(--glass-border);color:var(--text-primary);padding:.7rem 1.5rem;border-radius:12px;font-weight:600;cursor:pointer;transition:all var(--transition-speed) ease}.nav-btn:hover{background:var(--card-hover);transform:translateY(-2px)}.main-content{position:relative;z-index:1;padding:var(--spacing-xl) var(--spacing-lg)}.section-header{text-align:center;margin-bottom:var(--spacing-xl)}.section-header h2{font-size:2.5rem;font-weight:800}.upload-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-lg)}.upload-box{background:var(--card-bg);backdrop-filter:blur(20px);border:2px dashed var(--card-border);border-radius:20px;padding:var(--spacing-xl);transition:all var(--transition-speed) ease;cursor:pointer}.upload-box:hover{transform:scale(1.02);box-shadow:0 20px 60px rgba(0,0,0,.3)}.upload-box.uploaded{border-color:var(--success-color);background:rgba(67,233,123,.1);border-style:solid}.file-input{display:none}.upload-label{display:flex;flex-direction:column;align-items:center;gap:var(--spacing-sm);cursor:pointer;color:var(--text-primary);text-align:center}.upload-label h3{font-size:1.5rem;font-weight:700}.file-name{background:rgba(67,233,123,.2);padding:.5rem 1rem;border-radius:10px;display:none}.upload-box.uploaded .file-name{display:block}.btn-primary,.btn-secondary{display:inline-flex;align-items:center;gap:.5rem;padding:var(--spacing-sm) var(--spacing-lg);border-radius:12px;font-weight:700;cursor:pointer;transition:all var(--transition-speed) ease;border:none}.btn-primary{background:linear-gradient(135deg,var(--success-color) 0%,#38f9d7 100%);color:#fff;box-shadow:0 10px 30px rgba(67,233,123,.3)}.btn-primary:hover{transform:translateY(-2px)}.btn-secondary{background:var(--card-bg);color:var(--text-primary);border:1px solid var(--card-border)}.reconciliation-engine{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid var(--card-border);border-radius:20px;padding:var(--spacing-xl);margin:var(--spacing-xl) 0;text-align:center}.engine-icon{color:var(--success-color);filter:drop-shadow(0 0 30px rgba(67,233,123,.6));display:inline-block;margin-bottom:var(--spacing-md)}.rotating{animation:rotate 2s linear infinite}@keyframes rotate{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.progress-bar{width:100%;height:12px;background:var(--glass-bg);border-radius:10px;overflow:hidden;margin:var(--spacing-lg) 0}.progress-fill{height:100%;background:linear-gradient(90deg,var(--success-color) 0%,#38f9d7 100%);border-radius:10px;width:0;transition:width .5s ease}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--spacing-md);margin-bottom:var(--spacing-xl)}.stat-card{background:var(--card-bg);backdrop-filter:blur(20px);border-radius:var(--border-radius);padding:var(--spacing-md);display:flex;align-items:center;gap:var(--spacing-md);transition:all var(--transition-speed) ease;border-left:4px solid}.stat-card:hover{transform:scale(1.05)}.stat-value{font-size:2rem;font-weight:800}.charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-xl)}.chart-card{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid var(--card-border);border-radius:20px;padding:var(--spacing-lg)}.chart-card h3{text-align:center;margin-bottom:var(--spacing-md)}.table-controls{display:flex;justify-content:space-between;gap:var(--spacing-md);margin-bottom:var(--spacing-lg);flex-wrap:wrap}.search-box{display:flex;align-items:center;gap:.5rem;background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;padding:.7rem var(--spacing-md);flex:1;max-width:400px}.search-box input{background:0 0;border:none;color:var(--text-primary);outline:0;width:100%}.filter-tabs{display:flex;gap:.5rem;background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;padding:.3rem}.tab-btn{background:0 0;border:none;color:rgba(255,255,255,.9);padding:.6rem var(--spacing-md);border-radius:8px;font-weight:600;cursor:pointer;transition:all var(--transition-speed) ease}.tab-btn.active{background:var(--success-color);color:#fff}.table-container{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid var(--card-border);border-radius:var(--border-radius);overflow-x:auto;margin-bottom:var(--spacing-lg)}table{width:100%;border-collapse:collapse;color:var(--text-primary)}th{padding:var(--spacing-sm) var(--spacing-md);text-align:left;font-weight:600;border-bottom:2px solid var(--card-border)}th.sortable{cursor:pointer}td{padding:var(--spacing-sm) var(--spacing-md);border-bottom:1px solid var(--card-border)}tbody tr:hover{background:var(--card-hover)}.status-badge{padding:.4rem .8rem;border-radius:8px;font-size:.85rem;font-weight:600;display:inline-block}.status-badge.success{background:rgba(67,233,123,.2);color:var(--success-color)}.status-badge.warning{background:rgba(255,107,157,.2);color:var(--warning-color)}.match-score{font-weight:700}.match-score.high{color:var(--success-color)}.match-score.medium{color:var(--gold-color)}.match-score.low{color:var(--warning-color)}.pagination{display:flex;justify-content:center;gap:.5rem;margin-top:var(--spacing-lg)}.pagination button{background:var(--card-bg);border:1px solid var(--card-border);color:var(--text-primary);padding:.6rem var(--spacing-sm);border-radius:8px;cursor:pointer;min-width:40px}.pagination button.active{background:var(--success-color);color:#fff}.hidden{display:none!important}@media (max-width:768px){.upload-grid,.charts-grid,.stats-grid{grid-template-columns:1fr}}</style>
</head>
<body>
<div class="background-animation"><div class="gradient-orb orb-1"></div><div class="gradient-orb orb-2"></div><div class="gradient-orb orb-3"></div></div>
<header class="header"><div class="container header-content"><div class="logo"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline></svg><h1>O2C Reconciliation</h1><span class="badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>World #1</span></div><nav class="nav"><button class="nav-btn">Dashboard</button><button class="nav-btn">Analytics</button></nav></div></header>
<main class="main-content container">
<section class="upload-section"><div class="section-header"><h2>Upload Your Data</h2><p>Upload Excel files for intelligent AI-powered reconciliation</p></div><div class="upload-grid"><div class="upload-box" id="invoice-upload-box"><input type="file" id="invoice-file" accept=".xlsx,.xls,.csv" class="file-input"><label for="invoice-file" class="upload-label"><svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg><h3>Invoice Data</h3><p>Upload invoice Excel file</p><span class="file-name" id="invoice-name"></span></label></div><div class="upload-box" id="bank-upload-box"><input type="file" id="bank-file" accept=".xlsx,.xls,.csv" class="file-input"><label for="bank-file" class="upload-label"><svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg><h3>Bank Statement</h3><p>Upload bank Excel file</p><span class="file-name" id="bank-name"></span></label></div></div><div style="text-align:center;margin-top:2rem"><button id="generate-sample" class="btn-secondary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path></svg>Generate Sample Data</button></div></section>
<section class="reconciliation-engine hidden" id="engine-section"><div class="engine-content"><div class="engine-icon rotating"><svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"></rect></svg></div><h2>AI Reconciliation Engine</h2><p id="status">Initializing...</p><div class="progress-bar"><div class="progress-fill" id="progress"></div></div><div style="font-size:1.5rem;font-weight:700;margin:1rem 0" id="progress-text">0%</div></div></section>
<section class="data-visualization hidden" id="visualization-section"><div class="section-header"><h2>Reconciliation Analytics</h2></div><div class="stats-grid" id="stats-grid"></div><div class="charts-grid"><div class="chart-card"><h3>Distribution</h3><canvas id="pieChart"></canvas></div><div class="chart-card"><h3>Summary</h3><canvas id="barChart"></canvas></div></div></section>
<section class="results-section hidden" id="results-section"><div class="section-header"><h2>Results</h2><button id="export-btn" class="btn-primary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline></svg>Export Excel</button></div><div class="table-controls"><div class="search-box"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg><input type="search" id="search-input" placeholder="Search..."></div><div class="filter-tabs"><button class="tab-btn active" data-filter="all">All</button><button class="tab-btn" data-filter="matched">Matched</button><button class="tab-btn" data-filter="unmatched">Unmatched</button></div></div><div class="table-container"><table><thead><tr><th class="sortable" data-sort="invoiceNumber">Invoice #</th><th class="sortable" data-sort="amount">Amount</th><th class="sortable" data-sort="date">Date</th><th class="sortable" data-sort="matchScore">Score</th><th>Bank Ref</th><th>Status</th></tr></thead><tbody id="results-tbody"></tbody></table></div><div class="pagination" id="pagination"></div></section>
</main>
<script>const S={invoiceData:null,bankData:null,results:null,currentFilter:'all',currentSort:{column:null,direction:'asc'},currentPage:1,itemsPerPage:10,searchQuery:'',config:{amountWeight:70,dateWeight:20,referenceWeight:10,threshold:75}};let pieChart,barChart;document.addEventListener('DOMContentLoaded',()=>{document.getElementById('invoice-file').addEventListener('change',e=>handleFileUpload(e,'invoice'));document.getElementById('bank-file').addEventListener('change',e=>handleFileUpload(e,'bank'));document.getElementById('generate-sample').addEventListener('click',generateSampleData);document.getElementById('export-btn').addEventListener('click',exportToExcel);document.getElementById('search-input').addEventListener('input',handleSearch);document.querySelectorAll('.tab-btn').forEach(b=>b.addEventListener('click',e=>handleFilterChange(e.target.dataset.filter)));document.querySelectorAll('th.sortable').forEach(t=>t.addEventListener('click',()=>handleSort(t.dataset.sort)))});async function handleFileUpload(e,type){const file=e.target.files[0];if(!file)return;try{const data=await parseExcelFile(file);if(type==='invoice'){S.invoiceData=normalizeData(data,'invoice');document.getElementById('invoice-name').textContent=file.name;document.getElementById('invoice-upload-box').classList.add('uploaded')}else{S.bankData=normalizeData(data,'bank');document.getElementById('bank-name').textContent=file.name;document.getElementById('bank-upload-box').classList.add('uploaded')}if(S.invoiceData&&S.bankData)await startReconciliation()}catch(err){alert('Error parsing file')}}function parseExcelFile(file){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=e=>{try{const data=new Uint8Array(e.target.result);const wb=XLSX.read(data,{type:'array'});const sheet=wb.Sheets[wb.SheetNames[0]];resolve(XLSX.utils.sheet_to_json(sheet))}catch(err){reject(err)}};reader.onerror=()=>reject(new Error('Failed'));reader.readAsArrayBuffer(file)})}function normalizeData(data,type){return data.map((r,i)=>{const n={};n.amount=parseFloat(r.Amount||r.amount||0);n.date=r.Date||r.date||new Date().toISOString().split('T')[0];if(type==='invoice'){n.invoiceNumber=r.InvoiceNumber||r['Invoice Number']||`INV-${String(i+1).padStart(5,'0')}`;n.reference=r.Reference||r.reference||'';n.customer=r.Customer||r.customer||''}else{n.reference=r.Reference||r.reference||`BANK-${String(i+1).padStart(5,'0')}`;n.description=r.Description||r.description||''}return n})}function generateSampleData(){const inv=[];for(let i=1;i<=50;i++){const amt=Math.round((Math.random()*9000+1000)*100)/100;const d=new Date();d.setDate(d.getDate()-Math.floor(Math.random()*30));inv.push({invoiceNumber:`INV-${String(i).padStart(5,'0')}`,amount:amt,date:d.toISOString().split('T')[0],customer:`Customer ${String.fromCharCode(65+(i%26))}`,reference:`REF-${String(i).padStart(4,'0')}`})}const bnk=[];for(let i=1;i<=45;i++){let amt,ref,dt;if(i<=45&&inv[i-1]){amt=inv[i-1].amount+(Math.random()>.9?(Math.random()-.5)*10:0);ref=inv[i-1].reference;const id=new Date(inv[i-1].date);id.setDate(id.getDate()+Math.floor(Math.random()*3));dt=id.toISOString().split('T')[0]}else{amt=Math.round((Math.random()*9000+1000)*100)/100;ref=`BANK-${String(i).padStart(4,'0')}`;const rd=new Date();rd.setDate(rd.getDate()-Math.floor(Math.random()*30));dt=rd.toISOString().split('T')[0]}bnk.push({reference:ref,amount:Math.round(amt*100)/100,date:dt,description:`Bank ${i}`})}S.invoiceData=inv;S.bankData=bnk;document.getElementById('invoice-name').textContent='Sample_Invoices.xlsx';document.getElementById('invoice-upload-box').classList.add('uploaded');document.getElementById('bank-name').textContent='Sample_Bank.xlsx';document.getElementById('bank-upload-box').classList.add('uploaded');startReconciliation()}async function startReconciliation(){document.getElementById('engine-section').classList.remove('hidden');document.getElementById('engine-section').scrollIntoView({behavior:'smooth'});await updateProgress(0,'Initializing...');await sleep(500);await updateProgress(20,'Parsing...');await sleep(800);await updateProgress(60,'Matching...');await sleep(1000);await updateProgress(95,'Generating...');await sleep(600);performReconciliation();await updateProgress(100,'Complete!');await sleep(500);document.getElementById('engine-section').classList.add('hidden');displayResults()}function updateProgress(p,s){return new Promise(r=>{document.getElementById('progress').style.width=p+'%';document.getElementById('progress-text').textContent=p+'%';document.getElementById('status').textContent=s;setTimeout(r,100)})}function sleep(ms){return new Promise(r=>setTimeout(r,ms))}function performReconciliation(){const matched=[],unmatched=[],used=new Set();S.invoiceData.forEach(inv=>{let best=null,score=0,idx=-1;S.bankData.forEach((b,i)=>{if(used.has(i))return;const sc=calculateMatchScore(inv,b);if(sc>score){score=sc;best=b;idx=i}});if(score>=S.config.threshold){used.add(idx);matched.push({invoiceNumber:inv.invoiceNumber,amount:inv.amount,date:inv.date,bankReference:best.reference,matchScore:Math.round(score),status:'matched',customer:inv.customer||''})}else{unmatched.push({invoiceNumber:inv.invoiceNumber,amount:inv.amount,date:inv.date,bankReference:best?best.reference:'N/A',matchScore:best?Math.round(score):0,status:'unmatched',customer:inv.customer||''})}});const total=S.invoiceData.reduce((s,i)=>s+i.amount,0);const mamt=matched.reduce((s,m)=>s+m.amount,0);S.results={matched,unmatched,summary:{totalInvoices:S.invoiceData.length,matchedCount:matched.length,unmatchedCount:unmatched.length,matchRate:((matched.length/S.invoiceData.length)*100).toFixed(1),totalAmount:total,matchedAmount:mamt,unmatchedAmount:total-mamt}}}function calculateMatchScore(inv,bnk){let sc=0;const diff=Math.abs(inv.amount-bnk.amount);const thr=inv.amount*0.01;const asc=diff<=thr?100:Math.max(0,100-(diff/inv.amount*100));sc+=(asc*S.config.amountWeight/100);const id=new Date(inv.date),bd=new Date(bnk.date);const dd=Math.abs((id-bd)/(1000*60*60*24));const dsc=Math.max(0,100-(dd*10));sc+=(dsc*S.config.dateWeight/100);const ir=(inv.reference||'').toLowerCase(),br=(bnk.reference||'').toLowerCase();let rsc=0;if(ir&&br){if(ir===br)rsc=100;else if(ir.includes(br)||br.includes(ir))rsc=70}sc+=(rsc*S.config.referenceWeight/100);return sc}function displayResults(){document.getElementById('visualization-section').classList.remove('hidden');document.getElementById('results-section').classList.remove('hidden');displayStats();displayCharts();displayTable();document.getElementById('visualization-section').scrollIntoView({behavior:'smooth'})}function displayStats(){const{summary:s}=S.results;document.getElementById('stats-grid').innerHTML=`<div class="stat-card" style="border-color:var(--success-color)"><div class="stat-icon-wrapper" style="background:rgba(67,233,123,0.2)"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="var(--success-color)" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline></svg></div><div><h4>Match Rate</h4><div class="stat-value">${s.matchRate}%</div></div></div><div class="stat-card" style="border-color:var(--info-color)"><div class="stat-icon-wrapper" style="background:rgba(79,172,254,0.2)"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="var(--info-color)" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></div><div><h4>Total</h4><div class="stat-value">$${s.totalAmount.toLocaleString('en-US',{minimumFractionDigits:2})}</div></div></div><div class="stat-card" style="border-color:var(--success-color)"><div class="stat-icon-wrapper" style="background:rgba(67,233,123,0.2)"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="var(--success-color)" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path></svg></div><div><h4>Matched</h4><div class="stat-value">${s.matchedCount}</div></div></div><div class="stat-card" style="border-color:var(--warning-color)"><div class="stat-icon-wrapper" style="background:rgba(255,107,157,0.2)"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="var(--warning-color)" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg></div><div><h4>Unmatched</h4><div class="stat-value">${s.unmatchedCount}</div></div></div>`}function displayCharts(){const{summary:s}=S.results;if(pieChart)pieChart.destroy();if(barChart)barChart.destroy();pieChart=new Chart(document.getElementById('pieChart').getContext('2d'),{type:'pie',data:{labels:['Matched','Unmatched'],datasets:[{data:[s.matchedCount,s.unmatchedCount],backgroundColor:['#43e97b','#ff6b9d'],borderWidth:0}]},options:{responsive:true,plugins:{legend:{labels:{color:'rgba(255,255,255,0.9)'}}}}});barChart=new Chart(document.getElementById('barChart').getContext('2d'),{type:'bar',data:{labels:['Total','Matched','Unmatched'],datasets:[{data:[s.totalInvoices,s.matchedCount,s.unmatchedCount],backgroundColor:['#4facfe','#43e97b','#ff6b9d'],borderRadius:8}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{ticks:{color:'rgba(255,255,255,0.9)'},grid:{color:'rgba(255,255,255,0.1)'}},x:{ticks:{color:'rgba(255,255,255,0.9)'},grid:{color:'rgba(255,255,255,0.1)'}}}}})}function displayTable(){S.currentPage=1;renderTable();renderPagination()}function renderTable(){const tbody=document.getElementById('results-tbody');let data=[...S.results.matched,...S.results.unmatched];if(S.currentFilter==='matched')data=data.filter(i=>i.status==='matched');if(S.currentFilter==='unmatched')data=data.filter(i=>i.status==='unmatched');if(S.searchQuery){const q=S.searchQuery.toLowerCase();data=data.filter(i=>i.invoiceNumber.toLowerCase().includes(q)||i.amount.toString().includes(q)||i.date.includes(q))}if(S.currentSort.column){data.sort((a,b)=>{let av=a[S.currentSort.column],bv=b[S.currentSort.column];if(S.currentSort.column==='amount'||S.currentSort.column==='matchScore'){av=parseFloat(av)||0;bv=parseFloat(bv)||0}if(av<bv)return S.currentSort.direction==='asc'?-1:1;if(av>bv)return S.currentSort.direction==='asc'?1:-1;return 0})}const start=(S.currentPage-1)*S.itemsPerPage;const page=data.slice(start,start+S.itemsPerPage);tbody.innerHTML=page.map(i=>{const sc=i.matchScore>=90?'high':i.matchScore>=70?'medium':'low';const st=i.status==='matched'?'success':'warning';const tx=i.status==='matched'?'✓ Matched':'⚠ Unmatched';return`<tr><td>${i.invoiceNumber}</td><td>$${i.amount.toLocaleString('en-US',{minimumFractionDigits:2})}</td><td>${i.date}</td><td><span class="match-score ${sc}">${i.matchScore}%</span></td><td>${i.bankReference||'N/A'}</td><td><span class="status-badge ${st}">${tx}</span></td></tr>`}).join('');S.filteredData=data}function renderPagination(){const pg=document.getElementById('pagination');const total=Math.ceil((S.filteredData?.length||0)/S.itemsPerPage);if(total<=1){pg.innerHTML='';return}let h=`<button ${S.currentPage===1?'disabled':''} onclick="changePage(${S.currentPage-1})">‹</button>`;for(let i=1;i<=total;i++){if(i===1||i===total||(i>=S.currentPage-1&&i<=S.currentPage+1)){h+=`<button class="${i===S.currentPage?'active':''}" onclick="changePage(${i})">${i}</button>`}}h+=`<button ${S.currentPage===total?'disabled':''} onclick="changePage(${S.currentPage+1})">›</button>`;pg.innerHTML=h}function changePage(p){S.currentPage=p;renderTable();renderPagination()}function handleSearch(e){S.searchQuery=e.target.value;S.currentPage=1;renderTable();renderPagination()}function handleFilterChange(f){S.currentFilter=f;S.currentPage=1;document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.filter===f));renderTable();renderPagination()}function handleSort(c){if(S.currentSort.column===c){S.currentSort.direction=S.currentSort.direction==='asc'?'desc':'asc'}else{S.currentSort.column=c;S.currentSort.direction='asc'}renderTable()}function exportToExcel(){const wb=XLSX.utils.book_new();const{summary:s,matched:m,unmatched:u}=S.results;const sum=[['O2C RECONCILIATION REPORT'],['Generated:',new Date().toLocaleString()],[''],['Total Invoices',s.totalInvoices],['Matched',s.matchedCount],['Unmatched',s.unmatchedCount],['Match Rate',s.matchRate+'%'],['Total Amount','$'+s.totalAmount.toLocaleString()]];XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(sum),'Summary');if(m.length>0)XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(m),'Matched');if(u.length>0)XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(u),'Unmatched');XLSX.writeFile(wb,`O2C_Report_${new Date().toISOString().split('T')[0]}.xlsx`)}window.changePage=changePage;</script>
</body>
</html>